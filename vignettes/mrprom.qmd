---
title: "mrprom"
format: html
description: |
  Creating input datasets for OPEN-PROM.
vignette: >
  %\VignetteIndexEntry{mrprom}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---

## Framework idea<br>
The problem with Excel tables:<br>
Intransparent<br>
Not reproducible<br>
Virtually impossible to track changes<br>
Error-prone<br>
Not suitable for large datasets<br>
Use of proprietary software

The Solution:<br>
MADRaT (May All Data be Reproducible and Transparent)<br>
Dietrich et al. (2025). "madrat: May All Data be Reproducible and Transparent (MADRaT)"<br>
"Tools used"
```{r, echo=FALSE, fig.cap="Tools used"}
knitr::include_graphics(system.file("extdata/14.png", package = "mrprom"))
```
Typical workflow mrprom:
A) requires a local directory to store data such as downloaded  source data, cache files, and output<br>
B) has the ability to load data from cache rather than recompute it when the calculations have run already before<br>
C) splits the data preparation into separate steps<br>
"Tools used"
```{r, echo=FALSE, fig.cap="Our input data framework"}
knitr::include_graphics(system.file("extdata/15.png", package = "mrprom"))
```
"Typical workflow"
```{r, echo=FALSE, fig.cap="Process of data preparation"}
knitr::include_graphics(system.file("extdata/16.png", package = "mrprom"))
```
"Use-cases (Adding a new source)"
```{r, echo=FALSE, fig.cap=""}
knitr::include_graphics(system.file("extdata/17.png", package = "mrprom"))
```

```{r, echo=FALSE, fig.cap="Use-cases (Adding a new source)"}
knitr::include_graphics(system.file("extdata/18.png", package = "mrprom"))
```

```{r, echo=FALSE, fig.cap="Use-cases (Adding a new source)"}
knitr::include_graphics(system.file("extdata/19.png", package = "mrprom"))
```
## FuelCons
The IEA dataset includes 160 countries and 29 regions with data available through 2023<br>
while all remaining countries in the 249-country output of calcOutput should be assigned zeros.<br>
The function readIEA2025() is responsible for importing these IEA values,<br>
maps them to the corresponding countries and regions used by the model, and explicitly fills in zero values for all<br> countries that are not covered by the IEA database.<br>
The regional aggregation performed in fullOPEN_PROM.
```{r, echo=TRUE, eval=FALSE}
# Example: read IEA balances
# data <- readIEA2025()
```
"Map between IEA flow and OPEM-PROM subsectors"
```{r, echo=FALSE, fig.cap="prom-iea-sbs.csv"}
knitr::include_graphics(system.file("extdata/2.png", package = "mrprom"))
```
"Map between IEA and OPEM-PROM fuels"
```{r, echo=FALSE, fig.cap="prom-iea-fuelcons-mapping.csv"}
knitr::include_graphics(system.file("extdata/3.png", package = "mrprom"))
```
"Disaggegation of Heat to various EFs by using Heat output of IEA"
```{r, echo=FALSE, fig.cap=""}
knitr::include_graphics(system.file("extdata/4.png", package = "mrprom"))
```
"Disaggregate Transport IEA sectors to Transport sector (e.g., GSL ROAD -> PC,PB,GU). The shares are from Eurostat"
```{r, echo=FALSE, fig.cap=""}
knitr::include_graphics(system.file("extdata/5.png", package = "mrprom"))
```

## FuelPrice
The IEA dataset contains information for 145 countries and 6 regions through 2023.<br>
The readIEATOTPRICES() function is responsible for importing these data.<br>
Within this function, the dataset is filtered where product = PRICE_TOTAL and CURENCY = USD_R,<br>
ensuring that only total price data expressed in real U.S. dollars are retained.<br>
Region mean is used for the rest of the countries that do not have data.<br>
The map that is used is `regionmappingH12.csv`.
```{r, echo=TRUE, eval=FALSE}
# Example: read IEA total prices
# data <- readIEATOTPRICES()
#
# # Filter for PRICE_TOTAL and USD_R
# filtered <- subset(data, product == "PRICE_TOTAL" & CURENCY == "USD_R")

```
"Map between IEA prices and OPEM-PROM prices"
```{r, echo=FALSE, fig.cap="prom-IEA-fuprice-mapping.csv"}
knitr::include_graphics(system.file("extdata/6.png", package = "mrprom"))
```
The units are converted to "USD2015/toe" in `convertIEATOTPRICES()`.<br>
Region mean is used for the rest of the countries that do not have data.<br>
The map that is used is `regionmappingH12.csv`.<br>
In the end H2F takes the biggest value of fuel that has each subsector
```{r, echo=FALSE, fig.cap="regionmappingH12.csv"}
knitr::include_graphics(system.file("extdata/7.png", package = "mrprom"))
```
## ElecProd
The IEA dataset provides information for 169 countries and 17 regions up to the year 2023,<br>
and all remaining countries in the 249-country structure used by the calcOutput function are assigned a value of zero.<br>
The readIEA2025() function is responsible for importing these data and handling<br>
the three available modes—NonCHP, CHP, and Total, map them to the model’s country list,<br>
and fill in zeros for countries not included in the IEA dataset. Regional aggregation is then<br>
performed downstream in fullOPEN_PROM<br>
There are 3 modes: NonCHP, CHP and Total
```{r, echo=TRUE, eval=FALSE}
# Example: read IEA balances
# data <- readIEA2025()
```
"Map between IEA flow and OPEM-PROM modes. Depending to the mode there is different IEA flow"
```{r, echo=TRUE, fig.cap="IEA flow and OPEM-PROM modes"}
  # if (mode == "NonCHP") {
  #   subset <- c("ELMAINE", "ELAUTOE")
  # } else if (mode == "CHP") {
  #   subset <- c("ELMAINC", "ELAUTOC")
  # } else if (mode == "Total") {
  #   subset <- "ELOUTPUT"
  # }
```
"Map between IEA and OPEM-PROM fuels"
```{r, echo=FALSE, fig.cap="prom-iea-fuelcons-mapping.csv"}
knitr::include_graphics(system.file("extdata/8.png", package = "mrprom"))
```
"For modes NonCHP and Total the map that is used is"
```{r, echo=FALSE, fig.cap=""}
knitr::include_graphics(system.file("extdata/9.png", package = "mrprom"))
```
"For mode CHP is"
```{r, echo=FALSE, fig.cap=""}
knitr::include_graphics(system.file("extdata/10.png", package = "mrprom"))
```
"To take the shares of technologies that are missing IInstCapPast (Capacity) function is used"
```{r, echo=TRUE, fig.cap=""}
# calcOutput(type = "IInstCapPast", mode = "Total", aggregate = FALSE)
```
## Capacity
ENERDATA provides data for 179 countries and 2 regions up to the year 2021,<br>
and all remaining countries in the 249-country structure required by the calcOutput function<br>
are assigned zero values to ensure full global coverage.<br>
The readENERDATA() function is responsible for importing these ENERDATA inputs,<br>
mapping the available country and regional entries to the model’s complete country list.<br>
Once the full 249-country dataset is constructed, the regional aggregation is carried out in fullOPEN_PROM.<br>
There are 4 modes: NonCHP, CHP, Total and TotalEff.
```{r, echo=TRUE, eval=FALSE}
# Example: read ENERDATA balances
# data <- readENERDATA()
```
There are 4 modes: NonCHP, CHP, Total and TotalEff.<br>
For modes: NonCHP, CHP electricity production is used.
```{r, echo=TRUE, fig.cap="NonCHP, CHP"}
    # capacities <- calcOutput(
    #   type = "IDataElecProd", mode = mode, aggregate = FALSE
    # ) / hoursYear
```
For modes: Total, ENERDATA is used with the map prom-enerdata-pgall-mapping.csv
```{r, echo=FALSE, fig.cap="prom-enerdata-pgall-mapping.csv"}
knitr::include_graphics(system.file("extdata/11.png", package = "mrprom"))
```
For the TotalEff mode, ENERDATA is used together with the country-mapping file prom-enerdata-pgall-mapping.csv,<br>
following the same mapping approach as in the Total mode. After the ENERDATA values are mapped to the full 249-country<br> structure, availability rates from the relevant function (calcOutput(type = "IAvailRate", aggregate = FALSE))<br>
are applied by multiplying them with the mapped ENERDATA data.
```{r, echo=TRUE, fig.cap=""}
# calcOutput(type = "IAvailRate", aggregate = FALSE)
```
## TransfProcess
IEA provides data for 160 countries and 29 regions up to 2023, and all remaining countries in the 249-country<br>
structure expected by calcOutput are assigned zero values to ensure full coverage.<br>
The model handles three modes—Total, CHP, and DHP—and two flows, Inp and Out.<br>
The readIEA2025() function is responsible for importing the IEA dataset,<br>
filtering and structuring it according to mode and flow,<br>
mapping the available IEA entries to the full country list, and filling in zeros<br>
for countries not included in the IEA database.<br>
Regional aggregation is then performed in fullOPEN_PROM.
```{r, echo=TRUE, eval=FALSE}
# Example: read IEA balances
# data <- readIEA2025()
```
Map between IEA flow and OPEM-PROM depending to the mode<br>
If the mode is Total, then all available IEA data are used directly;<br>
otherwise, the dataset is filtered to include only CHP or DHP values depending on the selected mode.
```{r, echo=FALSE, fig.cap="iea-transfProcess-mapping.csv"}
knitr::include_graphics(system.file("extdata/12.png", package = "mrprom"))
```
Map between IEA and OPEM-PROM fuels
```{r, echo=FALSE, fig.cap="prom-iea-fuelcons-mapping.csv"}
knitr::include_graphics(system.file("extdata/13.png", package = "mrprom"))
```
If the flow is Inp, the negative values from the IEA dataset are selected,<br>
whereas if the flow is Out, the positive values are taken.

## calcACTV
Economic activity data for OPENPROM sectors are derived by combining two data sources. The first source covers<br> transport-related activity, including traffic and air transport passengers, provided per country and per year by IRF.<br>
The second source comes from GEME3, which supplies Production Level and Unit Cost data for the relevant sectors. 
```{r, echo=TRUE, eval=FALSE}
# x <- readSource("GEME3", convert = TRUE) #nolint
```
Map between GEME3 and OPEM-PROM depending
```{r, echo=FALSE, fig.cap="prom_geme3_map.csv"}
knitr::include_graphics(system.file("extdata/20.png", package = "mrprom"))
```

## calcIAvailRate
Represents the calculation of the plant availability rate by dividing production by installed capacity.<br>
Specifically, the production data are obtained from the calcOutput function with the type set to "IDataElecProd",<br>
the mode set to "Total". The installed capacity data are similarly obtained from calcOutput with the type set to<br> "IInstCapPast", the mode set to "Total".<br>
The availability rate is then calculated as production divided by installed capacity, expressed as a percentage,<br>
which indicates the proportion of the installed capacity that is actually generating electricity.
```{r, echo=TRUE, eval=FALSE}
#   Prod <- calcOutput(type = "IDataElecProd", mode = "Total", aggregate = FALSE) %>% as.quitte()
#   Cap <- calcOutput(type = "IInstCapPast", mode = "Total", aggregate = FALSE) %>% as.quitte()
```

## calcIChpPowGen
Use data from EU Reference Scenario to derive OPENPROM input table imDataChpPowGen<br>
This dataset includes CHP economic and technical data initialisation for electricity production.<br>
The availability factor is hardcoded and it is based on previous data.
```{r, echo=TRUE, eval=FALSE}
#   a <- calcOutput(type = "IChpPowGen", aggregate = FALSE)
```
Map between EU Reference Scenario and OPEM-PROM
```{r, echo=FALSE, fig.cap="prom-primes-chp-mapping.csv"}
knitr::include_graphics(system.file("extdata/21.png", package = "mrprom"))
```

## calcIDataDistrLosses
This dataset represents losses in energy distribution, transmission, and transport.<br>
The data are sourced from the IEA for 160 regions, while all remaining regions or countries are assigned a value of zero. 
```{r, echo=TRUE, eval=FALSE}
#   distrLosses <- readSource("IEA2025", subset = "DISTLOSS")
```
Map between IEA and OPEM-PROM
```{r, echo=FALSE, fig.cap="prom-iea-fuelcons-mapping.csv"}
knitr::include_graphics(system.file("extdata/3.png", package = "mrprom"))
```

## calcIDataElecSteamGen
Use data to derive OPENPROM input parameter iDataElecSteamGen
```{r, echo=TRUE, eval=FALSE}
#     NominalCapacities <- calcOutput(type = "IInstCapPast", mode="Total", aggregate = FALSE)
#     EffCapacities <- calcOutput(type = "IInstCapPast", mode="TotalEff", aggregate = FALSE) 
```
If there is value from NominalCapacities the data that is taken is from ENERDATA.
```{r, echo=TRUE, eval=FALSE}
#     readSource("ENERDATA", "capacity", convert = TRUE)
```
Afterwards, the data are multiplied by a reference table
```{r, echo=TRUE, eval=FALSE}
#           PEAKLOAD = TOTCAP * 0.9,
#      BASELOAD = PEAKLOAD * 0.3576,
#      Non_CHP_Per = 0.00000001,
#      CHP_Cap = 0.00000001,
#      CHP_ELC = 0.00000001,
#      # STE1CL = 0.0, STE1CH = 0.0, STE1CD = 0.0,
#      # STE1CR = 0.0, STE1CG = 0.0, STE1CB = 0.0,
#      STE1AL = 0.0, STE1AH = 0.0, STE1AD = 0.0,
```

## calcIDataGrossInlCons
This dataset includes data for gross inland consumption in Mtoe.<br>
Input data:
```{r, echo=TRUE, eval=FALSE}
#  x <- readSource("ENERDATA", "electricity", convert = TRUE)
#  own_use <- readSource("ENERDATA", "own", convert = TRUE)
#  refineries <- readSource("ENERDATA", "input", convert = TRUE)
#  torf <- readSource("ENERDATA", "production", convert = TRUE)
#  bio <- readSource("ENERDATA", "biomass", convert = TRUE)
#  indse <- calcOutput(type = "IFuelCons2", subtype = "INDSE", aggregate = FALSE)
#  domse <- calcOutput(type = "IFuelCons2", subtype = "DOMSE", aggregate = FALSE)
#  nense <- calcOutput(type = "IFuelCons2", subtype = "NENSE", aggregate = FALSE)
#  transe <- calcOutput(type = "IFuelCons2", subtype = "TRANSE", aggregate = FALSE) 
```
OPEN-PROM energy fuels:
```{r, echo=FALSE, fig.cap="EFS.csv"}
knitr::include_graphics(system.file("extdata/22.png", package = "mrprom"))
```
Afterwards, the input data are aggregated by fuel type, summing the values across relevant regions.<br>
Region mean is used for the rest of the countries that do not have data.<br>
The map that is used is `regionmappingH12.csv`.

## calcIDataImports
This dataset includes imports values for each region and fuel type in Mtoe.<br>
ENERDATA provides data for 179 countries and 2 regions up to the year 2021.<br>
The readENERDATA() function is responsible for importing these ENERDATA inputs.
```{r, echo=TRUE, eval=FALSE}
#     x <- readSource("ENERDATA", "imports", convert = TRUE)
```
Map between ENERDATA imports and OPEM-PROM
```{r, echo=FALSE, fig.cap="prom-enerdata-imports-mapping.csv"}
knitr::include_graphics(system.file("extdata/23.png", package = "mrprom"))
```
Region mean is used for the rest of the countries that do not have data.<br>
The map that is used is `regionmappingH12.csv`.

## calcIDataOwnConsEne
This dataset includes imports values for each region and fuel type in Mtoe.<br>
This dataset includes own consumption values for each region and energy branch in Mtoe.<br>
Map between IEA and OPEM-PROM
```{r, echo=FALSE, fig.cap="prom-iea-fuelcons-mapping.csv"}
knitr::include_graphics(system.file("extdata/3.png", package = "mrprom"))
```
Map between ENERDATA imports and OPEM-PROM
```{r, echo=FALSE, fig.cap="prom-iea-ef.csv"}
knitr::include_graphics(system.file("extdata/24.png", package = "mrprom"))
```
While all remaining regions or countries are assigned a value of zero.<br>
The own-use sector from the IEA dataset is disaggregated into the specific energy forms produced.<br>
For example, the IEA category EGASWKS is broken down into the energy forms it produces, such as ELC and STE. This<br> disaggregation ensures that own-use energy consumption is correctly attributed to the individual energy forms within<br> the model.

## calcIDataPassCars
This dataset has information about "End-of-life vehicles of / total-vehicles-in-use".<br>
Region mean is used for the rest of the countries that do not have data.<br>
The map that is used is `regionmappingH12.csv`.

## calcIDataPlantEffByType
This dataset includes plant efficiency per plant type, as a ratio.<br>
The data comes from  IEA and EU Reference Scenario.<br>
Map between IEA, EU Reference Scenario and OPEM-PROM.
```{r, echo=FALSE, fig.cap="prom-IEA-pgall-mapping.csv"}
knitr::include_graphics(system.file("extdata/25.png", package = "mrprom"))
```
Some power plant types are missing from EU Reference Scenario 2020.<br>
Temporarily adding data from PRIMES_COSTS/techn2009.xlsx.<br>
Assign the global from RefScen where necessary.

## calcIDataTechLftPlaType
This dataset includes technical lifetime per plant type, in years.<br>
Map between EU Reference Scenario and OPEM-PROM.
```{r, echo=FALSE, fig.cap="prom-primes-pgall-mapping.csv"}
knitr::include_graphics(system.file("extdata/26.png", package = "mrprom"))
```
Some power plant types are missing from EU Reference Scenario 2020.<br>
Temporarily adding data from PRIMES_COSTS/techn2009.xlsx.

## calcIDataTotTransfInputRef
This dataset has the refineries input in Mtoe.<br>
ENERDATA provides data for 179 countries and 2 regions up to the year 2021.<br>
The readENERDATA() function is responsible for importing these ENERDATA inputs.
```{r, echo=TRUE, eval=FALSE}
#       a <- readSource("ENERDATA", "input", convert = TRUE)
#       b <- a[, , "Crude oil consumption of refineries input"]
#       y <- a[, , "NGL (natural gas liquids) refineries input"]
```
Region mean is used for the rest of the countries that do not have data.<br>
The map that is used is `regionmappingH12.csv`.

## calcIDataTransfOutputRef
This dataset includes the transformation Output from Refineries.<br>
ENERDATA provides data for 179 countries and 2 regions up to the year 2021.<br>
The readENERDATA() function is responsible for importing these ENERDATA inputs.
```{r, echo=TRUE, eval=FALSE}
#       a <- readSource("ENERDATA", "production", convert = TRUE)
```
Map between ENERDATA production and OPEM-PROM.
```{r, echo=FALSE, fig.cap="prom-enerdata-refineries-mapping.csv"}
knitr::include_graphics(system.file("extdata/27.png", package = "mrprom"))
```
Region mean is used for the rest of the countries that do not have data.<br>
The map that is used is `regionmappingH12.csv`.

## calcIDataTransTech
Use technology cost data from the "EU Reference Scenario", MENA_EDS model data,<br>
and Technical Lifetime data from various sources to derive OPENPROM input parameter.<br>
The output data for Capital Costs (IC) per vehicle calculated from<br>
technology cost from the "EU Reference Scenario".<br>
The output data for Fixed Costs (FC) per vehicle is from MENA_EDS model.<br>
The output data for Technical Lifetime (LFT) is from US Department of<br>
Transportation, International Union of Railways, Statista, EU CORDIS.
```{r, echo=TRUE, eval=FALSE}
#       a <- readSource("TechCosts2024", subtype = "Medium_cars")
```
Map between EU Reference Scenario techs and OPEM-PROM.
```{r, echo=FALSE, fig.cap="iDataTransTech-mapping.csv"}
knitr::include_graphics(system.file("extdata/28.png", package = "mrprom"))
```
Map between EU Reference Scenario fuels and OPEM-PROM.
```{r, echo=FALSE, fig.cap="TTECH.csv"}
knitr::include_graphics(system.file("extdata/29.png", package = "mrprom"))
```

## calcIDecomPlants
Use decommisioning capacities of power plants data from the Global Energy Monitor.<br>
Read in a XLSX file and convert it to a quitte object.<br>
The data has information about capacities of power plants from the Global Energy Monitor.
```{r, echo=TRUE, eval=FALSE}
#     #the dataset x from readGEM is quitte object(decommisioned and installed plants in GW)
#     x <- readSource("GEM", convert = TRUE)
```
Map between Global Energy Monitor variables and OPEM-PROM.
```{r, echo=FALSE, fig.cap="iDataTransTech-mapping.csv"}
knitr::include_graphics(system.file("extdata/30.png", package = "mrprom"))
```
if value is NA assign it to 1e-08
